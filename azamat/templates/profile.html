{% extends "base.html" %}
{% load static %}
{% block content %}
<h1 class="text-2xl font-bold mb-6">My Profile</h1>

<div class="flex flex-col md:flex-row gap-6">
  
  <!-- Левая карточка -->
  <div class="w-full md:w-1/3 bg-white shadow rounded-lg p-4 text-center">
    {% if user.profile.avatar and user.profile.avatar.url %}
    <img src="{{ user.profile.avatar.url }}" class="rounded-full mx-auto mb-3 w-32 h-32 object-cover" alt="User Profile">
    {% else %}
    <img src="/media/avatars/default.jpg" class="rounded-full mx-auto mb-3 w-32 h-32 object-cover" alt="Default Avatar">
    {% endif %}
    <h5 class="text-xl font-semibold">{{ user.first_name }} {{ user.last_name }}</h5>
    <p class="text-gray-500">Web Developer</p>
    <ul class="mt-4 space-y-2 text-left">
      <li><a href="{% url 'profile' %}" class="text-blue-600 hover:underline">My Profile</a></li>
      <li><a href="{% url 'friends' %}" class="text-blue-600 hover:underline">Friends</a></li>
      <li><a href="#" class="text-blue-600 hover:underline">Group</a></li>
      <li><a href="{% url 'create_post' %}" class="text-blue-600 hover:underline">Create Post</a></li>
    </ul>
  </div>

  <!-- Правая карточка -->
  <div class="w-full md:w-2/3 bg-white shadow rounded-lg p-4 text-center">
    <img id="avatarPreview" src="{{ user.profile.avatar.url }}" alt="Avatar" class="mx-auto mb-4 w-36 h-36 rounded-full object-cover">
    <p class="mb-4 font-medium">{{ user.first_name }} {{ user.last_name }}</p>
    <form method="POST" enctype="multipart/form-data" class="space-y-4">
        {% csrf_token %}
        <div>
            {{ form.avatar.label_tag }}
            <input type="file" id="avatarInput" name="avatar" class="block mx-auto mt-2 text-sm">
        </div>
        <button type="button" id="deleteAvatarButton" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Удалить аватарку</button>
        <br>
        <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">Сохранить</button>
    </form>
  </div>
</div>

<script>
    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');

    avatarInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            avatarPreview.src = URL.createObjectURL(file);
        }
    });

    const deleteAvatarButton = document.getElementById('deleteAvatarButton');
    deleteAvatarButton.addEventListener('click', () => {
        if (confirm('Вы уверены, что хотите удалить аватарку?')) {
            fetch("{% url 'delete_avatar' %}", {
                method: 'POST',
                headers: { 'X-CSRFToken': '{{ csrf_token }}' }
            }).then(response => {
                if (response.ok) {
                    avatarPreview.src = '/media/avatars/default.jpg';
                } else {
                    alert('Не удалось удалить аватарку.');
                }
            });
        }
    });
</script>
{% endblock %}
